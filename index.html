<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Showcase</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/DRACOLoader.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0ebe5;
            overflow: hidden; /* Prevent scrollbars during transitions */
        }
        .background-text {
            font-size: 18vw;
            font-weight: 900;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            white-space: nowrap;
            user-select: none;
            z-index: 1;
            transition: color 0.7s ease-in-out, opacity 0.5s ease-in-out;
        }
        .product-image-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
        }
        .nav-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 20;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s, transform 0.3s;
        }
        .nav-arrow:hover {
            background-color: white;
            transform: translateY(-50%) scale(1.1);
        }
        .nav-arrow.left { left: 15%; }
        .nav-arrow.right { right: 15%; }
        
        .ui-elements {
            position: absolute;
            bottom: 10%;
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
            text-align: center;
        }

        @media (max-width: 768px) {
            .background-text { font-size: 25vw; }
            .nav-arrow.left { left: 5%; }
            .nav-arrow.right { right: 5%; }
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Header Navigation -->
    <header class="absolute top-0 left-0 right-0 z-20 px-4 sm:px-8 md:px-16 py-6">
        <div class="container mx-auto flex justify-between items-center">
            <div class="text-2xl font-bold tracking-wider"><a href="#">storemilk</a></div>
            <nav class="hidden md:flex items-center space-x-8 text-sm font-medium text-gray-600">
                <a href="#" class="hover:text-gray-900 transition-colors">Products</a>
                <a href="#" class="hover:text-gray-900 transition-colors">About</a>
                <a href="#" class="hover:text-gray-900 transition-colors">Partnership</a>
                <a href="#" class="hover:text-gray-900 transition-colors">Contact</a>
            </nav>
            <div class="flex items-center space-x-4">
                 <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600 hover:text-gray-900 cursor-pointer" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" /></svg>
                 <button id="mobile-menu-button" class="md:hidden"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" /></svg></button>
            </div>
        </div>
    </header>
    
    <!-- Mobile Menu -->
    <div id="mobile-menu" class="fixed top-0 left-0 w-full h-full bg-white z-40 transform -translate-x-full transition-transform duration-300 ease-in-out md:hidden">
        <div class="flex justify-end p-6"><button id="close-mobile-menu"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button></div>
        <nav class="flex flex-col items-center justify-center h-full space-y-8 text-2xl">
            <a href="#" class="nav-link">Products</a><a href="#" class="nav-link">About</a><a href="#" class="nav-link">Partnership</a><a href="#" class="nav-link">Contact</a>
        </nav>
    </div>

    <!-- Main Content Area -->
    <main class="relative w-full h-screen">
        <h1 id="background-text" class="background-text"></h1>
        <div id="product-canvas-container" class="product-image-container"></div>
        
        <div class="ui-elements">
            <button class="bg-white text-gray-800 font-semibold py-3 px-8 rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 transition-all">Shop Now</button>
        </div>

        <!-- Navigation Arrows -->
        <div id="prev-btn" class="nav-arrow left"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" /></svg></div>
        <div id="next-btn" class="nav-arrow right"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg></div>
    </main>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const productData = [
                { name: 'Almond', mainModel: 'AnyConv.com__tea-cup.glb', surroundingModel: 'walnuts.glb', color: '#e0d9d1' },
                { name: 'Lotus', mainModel: 'lotus.glb', surroundingModel: 'petals.glb', color: '#d1e0d9' },
                { name: 'Hazelnut', mainModel: 'AnyConv.com__tea-cup.glb', surroundingModel: 'walnuts.glb', color: '#e0d1d1' },
                { name: 'Walnut', mainModel: 'AnyConv.com__tea-cup.glb', surroundingModel: 'walnuts.glb', color: '#d9e0d1' },
            ];

            let currentProductIndex = 0;
            let isTransitioning = false;

            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 5;
            
            const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.shadowMap.enabled = true; // Enable shadows
            document.getElementById('product-canvas-container').appendChild(renderer.domElement);

            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(5, 10, 7.5);
            directionalLight.castShadow = true; // Make light cast shadows
            directionalLight.shadow.mapSize.width = 1024;
            directionalLight.shadow.mapSize.height = 1024;
            scene.add(directionalLight);

            // Ground plane to receive shadows
            const ground = new THREE.Mesh(
                new THREE.PlaneGeometry(20, 20),
                new THREE.ShadowMaterial({ opacity: 0.3 })
            );
            ground.rotation.x = -Math.PI / 2;
            ground.position.y = -2;
            ground.receiveShadow = true;
            scene.add(ground);

            const loader = new THREE.GLTFLoader();
            const dracoLoader = new THREE.DRACOLoader();
            dracoLoader.setDecoderPath('https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/libs/draco/');
            loader.setDRACOLoader(dracoLoader);
            const loadedModels = {};
            let mainProductGroup = new THREE.Group();
            let surroundingGroup = new THREE.Group();
            scene.add(mainProductGroup, surroundingGroup);

            function setOpacity(obj, opacity) {
                obj.traverse(child => {
                    if (child.isMesh) {
                        child.material.transparent = true;
                        child.material.opacity = opacity;
                    }
                });
            }

            function loadModel(url) {
                return new Promise((resolve, reject) => {
                    if (loadedModels[url]) return resolve(loadedModels[url].clone());
                    loader.load(url, (gltf) => {
                        const model = gltf.scene;
                        model.traverse(child => {
                           if(child.isMesh) child.castShadow = true;
                        });
                        loadedModels[url] = model;
                        resolve(model.clone());
                    }, undefined, (err) => {
                         console.error(`Failed to load ${url}`, err);
                         // Resolve with a fallback cube if loading fails
                         const fallback = new THREE.Mesh(new THREE.BoxGeometry(), new THREE.MeshStandardMaterial({color: 0xff0000}));
                         resolve(fallback);
                    });
                });
            }
            function fitAndCenterObject(obj, targetHeight = 4) {
                obj.updateWorldMatrix(true, true);
                const box = new THREE.Box3().setFromObject(obj);
                const size = box.getSize(new THREE.Vector3());
                const center = box.getCenter(new THREE.Vector3());
                // Center at origin
                obj.position.sub(center);
                // Scale to target height
                const h = size.y || 1;
                const factor = targetHeight / h;
                obj.scale.multiplyScalar(factor);
                // Lift slightly so it sits nicely above ground
                obj.position.y += 0.2;
            }
            
            async function transitionTo(index) {
                if (isTransitioning) return;
                isTransitioning = true;
                
                const nextProduct = productData[index];
                const fadeSpeed = 0.05;
                const spinSpeed = 0.2;

                // Animate out existing models, if any
                if (mainProductGroup.children.length > 0) {
                    let opacity = 1.0;
                    while (opacity > 0) {
                        opacity -= fadeSpeed;
                        mainProductGroup.rotation.y += spinSpeed;
                        setOpacity(mainProductGroup, Math.max(0, opacity));
                        setOpacity(surroundingGroup, Math.max(0, opacity));
                        await new Promise(r => setTimeout(r, 16));
                    }
                }
                
                // Clear old objects from the scene
                while (mainProductGroup.children.length > 0) mainProductGroup.remove(mainProductGroup.children[0]);
                while (surroundingGroup.children.length > 0) surroundingGroup.remove(surroundingGroup.children[0]);
                
                // Update UI text
                const bgText = document.getElementById('background-text');
                bgText.style.opacity = '0';
                await new Promise(r => setTimeout(r, 200));
                bgText.textContent = nextProduct.name;
                bgText.style.color = nextProduct.color;
                bgText.style.opacity = '1';

                // Load and prepare new objects
                const mainModel = await loadModel(nextProduct.mainModel);
                fitAndCenterObject(mainModel, 4.5);
                setOpacity(mainModel, 0);
                mainProductGroup.add(mainModel);

                const surroundingTemplate = await loadModel(nextProduct.surroundingModel);
                 for (let i = 0; i < 10; i++) {
                    const s_obj = surroundingTemplate.clone();
                    s_obj.scale.set(0.2, 0.2, 0.2);
                    s_obj.position.set( (Math.random() - 0.5) * 6, (Math.random() - 0.5) * 4, (Math.random() - 0.5) * 6 );
                    s_obj.originalY = s_obj.position.y;
                    surroundingGroup.add(s_obj);
                }
                setOpacity(surroundingGroup, 0);

                // Animate in new models
                let opacity = 0.0;
                while (opacity < 1) {
                    opacity += fadeSpeed;
                    mainProductGroup.rotation.y += spinSpeed;
                    setOpacity(mainProductGroup, Math.min(1, opacity));
                    setOpacity(surroundingGroup, Math.min(1, opacity));
                    await new Promise(r => setTimeout(r, 16));
                }

                currentProductIndex = index;
                isTransitioning = false;
            }


            function animate() {
                requestAnimationFrame(animate);

                if (!isTransitioning) {
                   mainProductGroup.rotation.y += 0.005;
                }

                const time = Date.now() * 0.001;
                surroundingGroup.children.forEach(child => {
                    child.position.y = child.originalY + Math.sin(time + child.position.x) * 0.5;
                    child.rotation.x += 0.01;
                    child.rotation.y += 0.01;
                });
                
                renderer.render(scene, camera);
            }
            
            // Event Listeners
            document.getElementById('next-btn').addEventListener('click', () => {
                const nextIndex = (currentProductIndex + 1) % productData.length;
                transitionTo(nextIndex);
            });
            document.getElementById('prev-btn').addEventListener('click', () => {
                const prevIndex = (currentProductIndex - 1 + productData.length) % productData.length;
                transitionTo(prevIndex);
            });
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });

            // Initial Load
            transitionTo(0);
            animate();
        });
    </script>
</body>
</html>


